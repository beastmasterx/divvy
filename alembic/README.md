# Alembic Database Migrations

This directory contains database migration scripts managed by Alembic.

## Overview

This project uses Alembic for database schema version control and migrations. The configuration supports multiple database backends (SQLite, PostgreSQL, MySQL, MSSQL) through the application's database connection module.

## Quick Start

### Check Migration Status

```bash
alembic current
```

### Create a New Migration

After modifying models in `app/models/models.py`:

```bash
alembic revision --autogenerate -m "Description of changes"
```

**Important:** Always review the generated migration file before applying it!

### Apply Migrations

```bash
# Apply all pending migrations
alembic upgrade head

# Apply migrations one step at a time
alembic upgrade +1

# Apply to a specific revision
alembic upgrade <revision_id>
```

### Rollback Migrations

```bash
# Rollback one migration
alembic downgrade -1

# Rollback to a specific revision
alembic downgrade <revision_id>

# Rollback all migrations
alembic downgrade base
```

### View Migration History

```bash
# Show migration history
alembic history

# Show detailed history
alembic history --verbose
```

## Configuration

- **Configuration file:** `alembic.ini` (in project root)
- **Environment script:** `alembic/env.py`
- **Migration files:** `alembic/versions/`

The migration system is configured to:

- Use the database URL from `app.db.connection.get_database_url()`
- Automatically detect model changes from `app.models.Base.metadata`
- Support all database backends configured in the application

## Best Practices

1. **Always review autogenerated migrations** - Alembic may not detect all changes correctly
2. **Test migrations** - Test both upgrade and downgrade paths
3. **Use descriptive messages** - Write clear migration messages
4. **Commit migration files** - Migration files should be version controlled
5. **Coordinate with team** - Avoid creating conflicting migrations when working in parallel

## Troubleshooting

### Migration conflicts

If multiple developers create migrations simultaneously:

1. Pull latest changes
2. If there are conflicts, use `alembic merge` to create a merge migration
3. Review and test the merged migration

### Database out of sync

If the database schema doesn't match migrations:

```bash
# Check current state
alembic current

# Compare with models
alembic revision --autogenerate -m "Sync schema"
```

## Additional Resources

- [Alembic Documentation](https://alembic.sqlalchemy.org/)
- [SQLAlchemy Documentation](https://docs.sqlalchemy.org/)
